<body class="container">

<div class="row">
	<%= image_tag "marbles_logo.png", alt: "Marbles Game Logo", class: "marbles_logo"%>
</div>

<h1 id="header">Games</h1>

<table class="table table-bordered">
  <thead>
    <tr>
      <th class="col-sm-2">Name</th>
      <th class="col-sm-2">Date</th>
      <th class="col-sm-1">Status</th>
      <th class="col-sm-2">Teams/Players</th>
	  <th class="col-sm-1">Winner</th>
      <th class="col-sm-1">Turn</th>
    </tr>
  </thead>

  <tbody>
	<% current_time = Time.now.to_i%>
    <% @games.order(start_date: :desc).each do |game| %>
		<% players = game.yplayer+","+game.gplayer+","+game.rplayer+","+game.bplayer %>
		<% player_array = players.split(",") %>
		<% player_array = player_array.reject { |c| c.empty?} %>
		<% players = player_array.join(",") %>
		<% if players.include?(@user_name) || @user_email == "wmshockey@gmail.com" %>
	      <tr>
			<% if (current_time - game.updated_at.to_time.to_i) <= 300 %>
	       	 	<td class="col-sm-2 blinking"><%= game.name %></td>
			<% else %>
				<td class="col-sm-2"><%= game.name %></td>
			<% end %>
	        <td class="col-sm-2"><%= game.start_date  %></td>
	        <td class="col-sm-1"><%= game.status %></td>
	        <td class="col-sm-4">
				<% if game.ryteam!="" %>
					<div style="display:inline-block"><%= game.ryteam %></div>
					<div style="display:inline-block; color:red"><%= "(" + game.rplayer + ", " %></div>
					<div style="display:inline-block; color:yellow"><%= game.yplayer + ")"%></div>
				<% else %>
					<% if game.rplayer!="" %>
						<div style="display:inline-block; color:red"><%= game.rplayer + ", " %></div>
					<% end %>
					<% if game.yplayer!=""%>
						<div style="display:inline-block; color:yellow"><%= game.yplayer + ", "%></div>
					<% end %>
				<% end %>		
				<% if game.gbteam!="" %>
					<br>
					<div style="display:inline-block"><%= game.gbteam %></div>
					<div style="display:inline-block; color:green"><%= "(" + game.gplayer + ", " %></div>
					<div style="display:inline-block; color:blue"><%= game.bplayer + ")"%></div>
				<% else %>
					<% if game.gplayer!="" %>
						<div style="display:inline-block; color:green"><%= game.gplayer + ", "%></div>
					<% end %>
					<% if game.bplayer!="" %>
						<div style="display:inline-block; color:blue"><%= game.bplayer%></div>
					<% end %>
				<% end %>
			</td>			
			<td class="col-sm-1"><%= game.winner %></td>
			<% turn = player_array[(game.turn).to_i] %>
	        <td class="col-sm-1"><%= turn.split(" ")[0] %></td>
	        <td class="col-sm-1 navbar-link"><%= link_to 'Play', game_path(game) %></td>
			<td class="col-sm-1 navbar-link"><%= link_to 'Edit', edit_game_path(game) %>
			<% if @user_email == "wmshockey@gmail.com" %>
				<td class="col-sm-1"><%= link_to 'Debug', debug_game_path(game) %></td>
			<% end %>
	        <td class="col-sm-1 navbar-link"><%= link_to 'Destroy', game, method: :delete, data: { confirm: 'Are you sure?' } %></td>
	      </tr>
		<% end %>
    <% end %>
  </tbody>
</table>

<br>

<%= button_to "New Game", new_game_path, method: :get %>


</body>